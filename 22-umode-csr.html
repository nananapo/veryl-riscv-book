<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>U-modeの実装 | veryl-riscv-book</title>
    <meta name="description" content="Write RISC-V CPU in Veryl">
    <meta name="generator" content="VitePress v2.0.0-alpha.12">
    <link rel="preload stylesheet" href="/assets/style.CaWnRaAO.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.C5T7VUJy.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Bi7Ru2r6.js">
    <link rel="modulepreload" href="/assets/chunks/framework.D5l_65jD.js">
    <link rel="modulepreload" href="/assets/22-umode-csr.md.BxF3jNM8.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-9f75dce3><div class="VPNavBar" data-v-9f75dce3 data-v-2a96a3d0><div class="wrapper" data-v-2a96a3d0><div class="container" data-v-2a96a3d0><div class="title" data-v-2a96a3d0><div class="VPNavBarTitle has-sidebar" data-v-2a96a3d0 data-v-1e38c6bc><a class="title" href="/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>veryl-riscv-book</span><!--[--><!--]--></a></div></div><div class="content" data-v-2a96a3d0><div class="content-body" data-v-2a96a3d0><!--[--><!--]--><div class="VPNavBarSearch search" data-v-2a96a3d0><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2a96a3d0 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/nananapo/bluecore" target="_blank" rel="noreferrer" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>プログラムを入手する</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-2a96a3d0 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2a96a3d0 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nananapo/veryl-riscv-book" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2a96a3d0 data-v-bb2aa2f0 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nananapo/veryl-riscv-book" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2a96a3d0 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-2a96a3d0><div class="divider-line" data-v-2a96a3d0></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-1df9f90f data-v-8acdfeb5><div class="container" data-v-8acdfeb5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-8acdfeb5><span class="vpi-align-left menu-icon" data-v-8acdfeb5></span><span class="menu-text" data-v-8acdfeb5>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-8acdfeb5 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-1df9f90f data-v-e7c6e512><div class="curtain" data-v-e7c6e512></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-e7c6e512><span class="visually-hidden" id="sidebar-aria-label" data-v-e7c6e512> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>第I部 RV32I/RV64Iの実装</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/00-preface.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>まえがき</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/02-setup.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>1 環境構築</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/03-veryl.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>2 ハードウェア記述言語 Veryl</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/04-impl-rv32i.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>3 RV32Iの実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/04a-zicsr.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>4 Zicsr拡張の実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/04b-riscvtests.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>5 riscv-testsによるテスト</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/05-impl-rv64i.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>6 RV64Iの実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/05a-pipeline.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>7 CPUのパイプライン化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/05b-synth.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>8 CPUの合成</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>第II部 RV64IMACの実装</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/10-impl-m.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>9 M拡張の実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/11-impl-exception.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>10 例外の実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/12-impl-mmio.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>11 Memory-mapped I/Oの実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/13-impl-a.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>12 A拡張の実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/14-impl-c.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>13 C拡張の実装</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0 has-active" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>第III部 特権/割り込みの実装</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/20-mmode-csr.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>14 M-modeの実装 (1. CSRの実装)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/21-impl-interrupt.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>15 M-modeの実装 (2. 割り込みの実装)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/22-umode-csr.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>16 U-modeの実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/23-smode-csr.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>17 S-modeの実装 (1. CSRの実装)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/24-impl-paging.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>18 S-modeの実装 (2. 仮想記憶システム)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/25-impl-plic.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>19 PLICの実装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/26-run-linux.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>20 Linuxを動かす</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/99-postface.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>あとがき (第Ⅰ部)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/99b-postface.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>あとがき (第Ⅱ部、第Ⅲ部)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/100-contribute.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>このプロジェクトに貢献する</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1df9f90f data-v-aff0b8d7><div class="VPDoc has-sidebar has-aside" data-v-aff0b8d7 data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>On this page</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-2d0bdf9b><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _22-umode-csr" data-v-7011f0d8><div><h1 id="u-modeの実装" tabindex="-1">U-modeの実装 <a class="header-anchor" href="#u-modeの実装" aria-label="Permalink to “U-modeの実装”">​</a></h1><p>本章ではRISC-Vで最も低い特権レベルであるUserモード(U-mode)を実装します。 U-modeはM-modeに管理されてアプリケーションを動かすための特権レベルであり、 M-modeで利用できていたほとんどのCSR、機能が制限されます。</p><p>本章で実装、変更する主な機能は次の通りです。 それぞれ解説しながら実装していきます。</p><ol><li>mstatusレジスタの一部のフィールド</li><li>CSRのアクセス権限、MRET命令の実行権限の確認</li><li>mcounterenレジスタ</li><li>割り込み条件、トラップの動作</li></ol><h2 id="misa-extensionsの変更" tabindex="-1">misa.Extensionsの変更 <a class="header-anchor" href="#misa-extensionsの変更" aria-label="Permalink to “misa.Extensionsの変更”">​</a></h2><p>U-modeを実装しているかどうかはmisa.ExtensionsのUビットで確認できます。</p><p>misa.ExtensionsのUビットを<code>1</code>にします (リスト1)。</p><p><span class="caption">▼リスト16.1: Uビットを1にする (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> misa    : UIntX  = {<span class="hljs-number">2&#39;d2</span>, <span class="hljs-number">1&#39;b0</span> <span class="hljs-keyword">repeat</span> XLEN - <span class="hljs-number">28</span>, <span class="hljs-number">26&#39;b00000</span><span class="custom-hl-bold"><span class="hljs-number">1</span></span><span class="hljs-number">00000001000100000101</span>}; <span class="hljs-comment">// U, M, I, C, A</span>
</code></pre></div><h2 id="mstatus-uxlの実装" tabindex="-1">mstatus.UXLの実装 <a class="header-anchor" href="#mstatus-uxlの実装" aria-label="Permalink to “mstatus.UXLの実装”">​</a></h2><p>U-modeのときのXLENはUXLENと定義されておりmstatus.UXLで確認できます。 仕様上はmstatus.UXLの書き換えでUXLENを変更できるように実装できますが、 本書ではUXLENが常に<code>64</code>になるように実装します。</p><p>mstatus.UXLを<code>64</code>を示す値である<code>2</code>に設定します ( リスト2、 リスト3 )。</p><p><span class="caption">▼リスト16.2: mstatus.UXLの定義 (eei.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-comment">// mstatus</span>
<span class="hljs-keyword">const</span> MSTATUS_UXL: UInt64 = <span class="hljs-number">2</span> &lt;&lt; <span class="hljs-number">32</span>;
</code></pre></div><p><span class="caption">▼リスト16.3: UXLの初期値を設定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">always_ff</span> {
    <span class="hljs-keyword">if_reset</span> {
        mode     = PrivMode::M;
        mstatus  = <span class="custom-hl-bold">MSTATUS_UXL</span>;
        mtvec    = <span class="hljs-number">0</span>;
</code></pre></div><h2 id="mstatus-twの実装" tabindex="-1">mstatus.TWの実装 <a class="header-anchor" href="#mstatus-twの実装" aria-label="Permalink to “mstatus.TWの実装”">​</a></h2><p>mstatus.TWは、M-modeよりも低い特権レベルでWFI命令を実行するときに時間制限(Timeout Wait)を設けるためのビットです。 mstatus.TWが<code>0</code>のとき時間制限はありません。 <code>1</code>に設定されているとき、CPUの実装固有の時間だけ実行の再開を待ち、 時間制限を過ぎるとIllegal instruction例外を発生させます。</p><p>本書ではmstatus.TWが<code>1</code>のときに無限時間待てることにして、例外の実装を省略します。 mstatus.TWを書き換えられるようにします (リスト4)。</p><p><span class="caption">▼リスト16.4: 書き込みマスクを変更する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">const</span> MSTATUS_WMASK : UIntX = <span class="hljs-number">&#39;h0000_0000_00</span><span class="custom-hl-bold"><span class="hljs-number">2</span></span><span class="hljs-number">0_0088</span> <span class="hljs-keyword">as</span> UIntX;
</code></pre></div><h2 id="mstatus-mppの実装" tabindex="-1">mstatus.MPPの実装 <a class="header-anchor" href="#mstatus-mppの実装" aria-label="Permalink to “mstatus.MPPの実装”">​</a></h2><p>M-mode、U-modeだけが存在する環境でトラップが発生するとき、 CPUはmstatusレジスタのMPPフィールドに現在の特権レベル(を示す値)を保存し、 特権レベルをM-modeに変更します。 また、MRET命令を実行するとmstatus.MPPの特権レベルに移動するようになります。</p><p>これにより、 トラップによるU(M)-modeからM-modeへの遷移、 MRET命令によるM-modeからU-modeへの遷移を実現できます。</p><p>MRET命令を実行するとmstatus.MPPは実装がサポートする最低の特権レベルに設定されます。</p><p>M-modeからU-modeに遷移したいときは、mstatus.MPPをU-modeの値に変更し、 U-modeで実行を開始したいアドレスをmepcレジスタに設定してMRET命令を実行します。</p><p>mstatus.MPPに値を書き込めるようにします (リスト5)。</p><p><span class="caption">▼リスト16.5: 書き込みマスクを変更する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">const</span> MSTATUS_WMASK : UIntX = <span class="hljs-number">&#39;h0000_0000_0020_</span><span class="custom-hl-bold"><span class="hljs-number">18</span></span><span class="hljs-number">88</span> <span class="hljs-keyword">as</span> UIntX;
</code></pre></div><p>MPPには<code>2&#39;b00</code>(U-mode)と<code>2&#39;b11</code>(M-mode)のみ設定できるようにします。 サポートしていない値を書き込もうとする場合は現在の値を維持します ( リスト6、 リスト7 )。</p><p><span class="caption">▼リスト16.6: mstatusの書き込み (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>CsrAddr::MSTATUS : mstatus  = validate_mstatus(mstatus, wdata);
</code></pre></div><p><span class="caption">▼リスト16.7: mstatusレジスタの値を確認する関数 (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">function</span> validate_mstatus (
    mstatus: <span class="hljs-keyword">input</span> UIntX,
    wdata  : <span class="hljs-keyword">input</span> UIntX,
) -&gt; UIntX {
    <span class="hljs-keyword">var</span> result: UIntX;
    result = wdata;
    <span class="hljs-comment">// MPP</span>
    <span class="hljs-keyword">if</span> wdata[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>] != PrivMode::M &amp;&amp; wdata[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>] != PrivMode::U {
        result[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>] = mstatus[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>];
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre></div><p>トラップが発生する、トラップから戻るときの遷移先の特権レベルを求めます ( リスト8、 リスト9、 リスト10、 リスト11、 リスト12 )。</p><p><span class="caption">▼リスト16.8: ビットを変数として定義する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="custom-hl-bold"><span class="hljs-keyword">let</span> mstatus_mpp : PrivMode = mstatus[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>] <span class="hljs-keyword">as</span> PrivMode;</span>
<span class="hljs-keyword">let</span> mstatus_mpie: <span class="hljs-keyword">logic</span>    = mstatus[<span class="hljs-number">7</span>];
<span class="hljs-keyword">let</span> mstatus_mie : <span class="hljs-keyword">logic</span>    = mstatus[<span class="hljs-number">3</span>];
</code></pre></div><p><span class="caption">▼リスト16.9: 割り込みの遷移先の特権レベルを示す変数 (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> interrupt_mode: PrivMode = PrivMode::M;
</code></pre></div><p><span class="caption">▼リスト16.10: 例外の遷移先の特権レベルを示す変数 (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> expt_mode  : PrivMode = PrivMode::M;
</code></pre></div><p><span class="caption">▼リスト16.11: MRET命令の遷移先の特権レベルを示す変数 (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> trap_return_mode: PrivMode = mstatus_mpp;
</code></pre></div><p><span class="caption">▼リスト16.12: 遷移先の特権レベルを求める (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> trap_mode_next: PrivMode = <span class="hljs-keyword">switch</span> {
    raise_expt     : expt_mode,
    raise_interrupt: interrupt_mode,
    trap_return    : trap_return_mode,
    <span class="hljs-keyword">default</span>        : PrivMode::U,
};
</code></pre></div><p>トラップが発生するとき、mstatus.MPPに現在の特権レベルを保存します (リスト13)。 また、トラップから戻るとき、特権レベルをmstatus.MPPに設定し、 mstatus.MPPに実装がサポートする最小の特権レベルである<code>PrivMode::U</code>を書き込みます。</p><p><span class="caption">▼リスト16.13: 特権レベル、mstatus.MPPを更新する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">if</span> raise_trap {
    <span class="hljs-keyword">if</span> raise_expt || raise_interrupt {
        ...
        <span class="custom-hl-bold"><span class="hljs-comment">// save current privilege level to mstatus.mpp</span></span>
        @&lt;b&lt;|mstatus[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>] = mode;|
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> trap_return {
        ...
        <span class="custom-hl-bold"><span class="hljs-comment">// set mstatus.mpp = U (least privilege level)</span></span>
        <span class="custom-hl-bold">mstatus[<span class="hljs-number">12</span>:<span class="hljs-number">11</span>] = PrivMode::U;</span>
    }
    <span class="custom-hl-bold">mode = trap_mode_next;</span>
</code></pre></div><h2 id="csrのアクセス権限の確認" tabindex="-1">CSRのアクセス権限の確認 <a class="header-anchor" href="#csrのアクセス権限の確認" aria-label="Permalink to “CSRのアクセス権限の確認”">​</a></h2><p>CSRのアドレスを<code>csr_addr</code>とするとき、 <code>csr_addr[9:8]</code>の2ビットはそのCSRにアクセスできる最低の特権レベルを表しています。 これを下回る特権レベルでCSRにアクセスしようとするとIllegal instruction例外が発生します。</p><p>CSRのアドレスと特権レベルを確認して、例外を起こすようにします ( リスト14、 リスト15、 リスト16 )。</p><p><span class="caption">▼リスト16.14: 現在の特権レベルでCSRにアクセスできるか判定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> expt_csr_priv_violation: <span class="hljs-keyword">logic</span> = is_wsc &amp;&amp; csr_addr[<span class="hljs-number">9</span>:<span class="hljs-number">8</span>] &gt;: mode; <span class="hljs-comment">// attempt to access CSR without privilege level</span>
</code></pre></div><p><span class="caption">▼リスト16.15: 例外の発生条件に追加する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> raise_expt: <span class="hljs-keyword">logic</span> = valid &amp;&amp; (expt_info.valid || expt_write_readonly_csr || <span class="custom-hl-bold">expt_csr_priv_violation</span>);
</code></pre></div><p><span class="caption">▼リスト16.16: causeを設定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>expt_write_readonly_csr: CsrCause::ILLEGAL_INSTRUCTION,
<span class="custom-hl-bold">expt_csr_priv_violation: CsrCause::ILLEGAL_INSTRUCTION,</span>
<span class="hljs-keyword">default</span>                : <span class="hljs-number">0</span>,
</code></pre></div><h2 id="mcounterenレジスタの実装" tabindex="-1">mcounterenレジスタの実装 <a class="header-anchor" href="#mcounterenレジスタの実装" aria-label="Permalink to “mcounterenレジスタの実装”">​</a></h2><p><img src="/assets/mcounteren.Dve5JPbf.png" alt="mcounterenレジスタ"> mcounterenレジスタは、M-modeの次に低い特権レベルで ハードウェアパフォーマンスモニタにアクセスできるようにするかを制御する32ビットのレジスタです(図1)。 CY、TM、IRビットはそれぞれcycle、time、instretにアクセスできるかどうかを制御します<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>。</p><p>本章でM-modeの次に低い特権レベルとしてU-modeを実装するため、 mcounterenレジスタはU-modeでのアクセスを制御します。 mcounterenレジスタで許可されていないままU-modeでcycle、time、instretレジスタにアクセスしようとすると、 Illelgal Instruction例外が発生します。</p><p>mcounterenレジスタを作成し、CY、TM、IRビットに書き込みできるようにします ( リスト17、 リスト19、 リスト20、 リスト21、 リスト18、 リスト22 )。</p><p><span class="caption">▼リスト16.17: mcounterenレジスタの定義 (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">var</span> mcounteren: UInt32;
</code></pre></div><p><span class="caption">▼リスト16.18: mcounterenレジスタを0でリセットする (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>mie        = <span class="hljs-number">0</span>;
<span class="custom-hl-bold">mcounteren = <span class="hljs-number">0</span>;</span>
mscratch   = <span class="hljs-number">0</span>;
</code></pre></div><p><span class="caption">▼リスト16.19: rdataにmcounterenレジスタを設定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>CsrAddr::MIE       : mie,
<span class="custom-hl-bold">CsrAddr::MCOUNTEREN: {<span class="hljs-number">1&#39;b0</span> <span class="hljs-keyword">repeat</span> XLEN - <span class="hljs-number">32</span>, mcounteren},</span>
CsrAddr::MCYCLE    : mcycle,
</code></pre></div><p><span class="caption">▼リスト16.20: 書き込みマスクの定義 (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">const</span> MCOUNTEREN_WMASK: UIntX = <span class="hljs-number">&#39;h0000_0000_0000_0007</span> <span class="hljs-keyword">as</span> UIntX;
</code></pre></div><p><span class="caption">▼リスト16.21: wmaskに書き込みマスクを設定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>CsrAddr::MIE       : MIE_WMASK,
<span class="custom-hl-bold">CsrAddr::MCOUNTEREN: MCOUNTEREN_WMASK,</span>
CsrAddr::MSCRATCH  : MSCRATCH_WMASK,
</code></pre></div><p><span class="caption">▼リスト16.22: mcounterenレジスタの書き込み (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>CsrAddr::MIE       : mie        = wdata;
<span class="custom-hl-bold">CsrAddr::MCOUNTEREN: mcounteren = wdata[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>];</span>
CsrAddr::MSCRATCH  : mscratch   = wdata;
</code></pre></div><p>U-modeでハードウェアパフォーマンスモニタにアクセスするとき、 mcounterenレジスタのビットが<code>0</code>ならIllegal instruction例外を発生させます ( リスト23、 リスト24 )。</p><p><span class="caption">▼リスト16.23: U-modeのとき、mcounterenレジスタを確認する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> expt_zicntr_priv       : <span class="hljs-keyword">logic</span> = is_wsc &amp;&amp; mode == PrivMode::U &amp;&amp; <span class="hljs-keyword">case</span> csr_addr {
    CsrAddr::CYCLE  : !mcounteren[<span class="hljs-number">0</span>],
    CsrAddr::TIME   : !mcounteren[<span class="hljs-number">1</span>],
    CsrAddr::INSTRET: !mcounteren[<span class="hljs-number">2</span>],
    <span class="hljs-keyword">default</span>         : <span class="hljs-number">0</span>,
}; <span class="hljs-comment">// attemp to access Zicntr CSR without permission</span>
</code></pre></div><p><span class="caption">▼リスト16.24: causeを設定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>expt_csr_priv_violation: CsrCause::ILLEGAL_INSTRUCTION,
<span class="custom-hl-bold">expt_zicntr_priv       : CsrCause::ILLEGAL_INSTRUCTION,</span>
<span class="hljs-keyword">default</span>                : <span class="hljs-number">0</span>,
</code></pre></div><h2 id="mret命令の実行を制限する" tabindex="-1">MRET命令の実行を制限する <a class="header-anchor" href="#mret命令の実行を制限する" aria-label="Permalink to “MRET命令の実行を制限する”">​</a></h2><p>MRET命令はM-mode以上の特権レベルのときにしか実行できません。 M-mode未満の特権レベルでMRET命令を実行しようとするとIllegal instruction例外が発生します。</p><p>命令がMRET命令のとき、特権レベルを確認して例外を発生させます ( リスト25、 リスト26、 リスト27 )。</p><p><span class="caption">▼リスト16.25: MRET命令を実行するとき、現在の特権レベルを確認する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> expt_trap_return_priv: <span class="hljs-keyword">logic</span> = is_mret &amp;&amp; mode &lt;: PrivMode::M; <span class="hljs-comment">// attempt to execute trap return instruction in low privilege level</span>
</code></pre></div><p><span class="caption">▼リスト16.26: 例外の発生条件に追加する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> raise_expt: <span class="hljs-keyword">logic</span> = valid &amp;&amp; (expt_info.valid || expt_write_readonly_csr || expt_csr_priv_violation || expt_zicntr_priv <span class="custom-hl-bold">|| expt_trap_return_priv</span>);
</code></pre></div><p><span class="caption">▼リスト16.27: causeを設定する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>    expt_zicntr_priv       : CsrCause::ILLEGAL_INSTRUCTION,
    <span class="custom-hl-bold">expt_trap_return_priv  : CsrCause::ILLEGAL_INSTRUCTION,</span>
    <span class="hljs-keyword">default</span>                : <span class="hljs-number">0</span>,
};
</code></pre></div><h2 id="ecall命令のcauseを変更する" tabindex="-1">ECALL命令のcauseを変更する <a class="header-anchor" href="#ecall命令のcauseを変更する" aria-label="Permalink to “ECALL命令のcauseを変更する”">​</a></h2><p>M-modeでECALL命令を実行するとEnvironment call from M-mode例外が発生します。 これに対してU-modeでECALL命令を実行するとEnvironment call from U-mode例外が発生します。 特権レベルと例外の対応は表1のようになっています。</p><div id="ecall.cause.table" class="table"><p class="caption">表16.1: ECALL命令を実行したときに発生する例外</p><table><tr class="hline"><th>特権レベル</th><th>例外</th><th>cause</th></tr><tr class="hline"><td>M-mode</td><td>Environment call from M-mode</td><td>11</td></tr><tr class="hline"><td>S-mode</td><td>Environment call from S-mode</td><td>9</td></tr><tr class="hline"><td>U-mode</td><td>Environment call from U-mode</td><td>8</td></tr></table></div> ここで各例外のcauseがU-modeのcauseに特権レベルの数値を足したものになっていることを利用します。 `CsrCause`型にEnvironment call from U-mode例外のcauseを追加します ( リスト28 )。 <p><span class="caption">▼リスト16.28: CsrCause型に例外のcauseを追加する (eei.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>STORE_AMO_ADDRESS_MISALIGNED = <span class="hljs-number">6</span>,
<span class="custom-hl-bold">ENVIRONMENT_CALL_FROM_U_MODE = <span class="hljs-number">8</span>,</span>
ENVIRONMENT_CALL_FROM_M_MODE = <span class="hljs-number">11</span>,
</code></pre></div><p>csrunitモジュールの<code>mode</code>レジスタをポート宣言に移動し、 IDステージでECALL命令をデコードするときにcauseに<code>mode</code>を足します ( リスト29、 リスト30、 リスト31、 リスト32 )。</p><p><span class="caption">▼リスト16.29: modeレジスタをポートに移動する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>rdata      : <span class="hljs-keyword">output</span>  UIntX               ,
<span class="custom-hl-bold">mode       : <span class="hljs-keyword">output</span>  PrivMode            ,</span>
raise_trap : <span class="hljs-keyword">output</span>  <span class="hljs-keyword">logic</span>               ,
</code></pre></div><p><span class="caption">▼リスト16.30: csrunitから現在の特権レベルを受け取る変数 (core.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">var</span> csru_priv_mode  : PrivMode;
</code></pre></div><p><span class="caption">▼リスト16.31: csrunitモジュールのインスタンスから現在の特権レベルを受け取る (core.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>rdata      : csru_rdata           ,
<span class="custom-hl-bold">mode       : csru_priv_mode       ,</span>
raise_trap : csru_raise_trap      ,
</code></pre></div><p><span class="caption">▼リスト16.32: Environment call from U-mode例外のcauseに特権レベルの数値を足す (core.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code>} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ids_inst_bits == <span class="hljs-number">32&#39;h00000073</span> {
    <span class="hljs-comment">// ECALL</span>
    exq_wdata.expt.valid      = <span class="hljs-number">1</span>;
    exq_wdata.expt.cause      = <span class="custom-hl-bold">CsrCause::ENVIRONMENT_CALL_FROM_U_MODE;</span>
    <span class="custom-hl-bold">exq_wdata.expt.cause[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] = csru_priv_mode;</span>
    exq_wdata.expt.value      = <span class="hljs-number">0</span>;
</code></pre></div><h2 id="割り込み条件の変更" tabindex="-1">割り込み条件の変更 <a class="header-anchor" href="#割り込み条件の変更" aria-label="Permalink to “割り込み条件の変更”">​</a></h2><p>M-modeだけが実装されたCPUで割り込みが発生する条件は<a href="./21-impl-interrupt.html">「15.1.2 RISC-Vの割り込み」</a>で解説しましたが、 M-modeとU-modeだけが実装されたCPUで割り込みが発生する条件は少し異なります。 M-modeとU-modeだけが実装されたCPUで割り込みが発生する条件は次の通りです。</p><ol><li>割り込み原因に対応したmipレジスタのビットが<code>1</code>である</li><li>割り込み原因に対応したmieレジスタのビットが<code>1</code>である</li><li>現在の特権レベルがM-mode未満である。またはmstatus.MIEが<code>1</code>である</li></ol><p>M-modeだけの場合と違い、 現在の特権レベルがU-modeのときはグローバル割り込みイネーブルビット(mstatus.MIE)の値は考慮されずに割り込みが発生します。</p><p>現在の特権レベルによって割り込みが発生する条件を切り替えます。 U-modeのときはmstatus.MIEを考慮しないようにします (リスト33)。</p><p><span class="caption">▼リスト16.33: U-modeのとき、割り込みの発生条件を変更する (csrunit.veryl)</span></p><div class="language-veryl"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="hljs"><code><span class="hljs-keyword">let</span> raise_interrupt  : <span class="hljs-keyword">logic</span> = valid &amp;&amp; can_intr &amp;&amp; <span class="custom-hl-bold">(mode != PrivMode::M ||</span> mstatus_mie<span class="custom-hl-bold">)</span> &amp;&amp; interrupt_pending != <span class="hljs-number">0</span>;
</code></pre></div><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>hpmcounterレジスタを制御するHPMビットもありますが、hpmcounterレジスタを実装していないので実装しません <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/21-impl-interrupt.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>15 M-modeの実装 (2. 割り込みの実装)</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/23-smode-csr.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>17 S-modeの実装 (1. CSRの実装)</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"00-preface.md\":\"DDGdJIg5\",\"02-setup.md\":\"NAwwJXp_\",\"03-veryl.md\":\"CfdP0nz9\",\"04-impl-rv32i.md\":\"D6HQhn-G\",\"04a-zicsr.md\":\"CThtddlO\",\"04b-riscvtests.md\":\"CW6e-oy1\",\"05-impl-rv64i.md\":\"DIMikneB\",\"05a-pipeline.md\":\"D92Nx-aw\",\"05b-synth.md\":\"CzClCWWq\",\"10-impl-m.md\":\"UxkEDKtO\",\"100-contribute.md\":\"CVKavJib\",\"11-impl-exception.md\":\"wScD8kDX\",\"12-impl-mmio.md\":\"BwxxU3HD\",\"13-impl-a.md\":\"CnPlYOpQ\",\"14-impl-c.md\":\"DqX93--N\",\"20-mmode-csr.md\":\"BSmJhJfG\",\"21-impl-interrupt.md\":\"BoBntBW9\",\"22-umode-csr.md\":\"BxF3jNM8\",\"23-smode-csr.md\":\"BTgvI4wQ\",\"24-impl-paging.md\":\"lA83XObo\",\"25-impl-plic.md\":\"BxNtHdp_\",\"26-run-linux.md\":\"CZfjbJCn\",\"99-postface.md\":\"CDNPw-b0\",\"99b-postface.md\":\"B_P9oVa3\",\"index.md\":\"7pP7Y4R2\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"veryl-riscv-book\",\"description\":\"Write RISC-V CPU in Veryl\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"プログラムを入手する\",\"link\":\"https://github.com/nananapo/bluecore\"}],\"sidebar\":[{\"text\":\"第I部 RV32I/RV64Iの実装\",\"items\":[{\"text\":\"まえがき\",\"link\":\"/00-preface\"},{\"text\":\"1 環境構築\",\"link\":\"/02-setup\"},{\"text\":\"2 ハードウェア記述言語 Veryl\",\"link\":\"/03-veryl\"},{\"text\":\"3 RV32Iの実装\",\"link\":\"/04-impl-rv32i\"},{\"text\":\"4 Zicsr拡張の実装\",\"link\":\"/04a-zicsr\"},{\"text\":\"5 riscv-testsによるテスト\",\"link\":\"/04b-riscvtests\"},{\"text\":\"6 RV64Iの実装\",\"link\":\"/05-impl-rv64i\"},{\"text\":\"7 CPUのパイプライン化\",\"link\":\"/05a-pipeline\"},{\"text\":\"8 CPUの合成\",\"link\":\"/05b-synth\"}]},{\"text\":\"第II部 RV64IMACの実装\",\"items\":[{\"text\":\"9 M拡張の実装\",\"link\":\"/10-impl-m\"},{\"text\":\"10 例外の実装\",\"link\":\"/11-impl-exception\"},{\"text\":\"11 Memory-mapped I/Oの実装\",\"link\":\"/12-impl-mmio\"},{\"text\":\"12 A拡張の実装\",\"link\":\"/13-impl-a\"},{\"text\":\"13 C拡張の実装\",\"link\":\"/14-impl-c\"}]},{\"text\":\"第III部 特権/割り込みの実装\",\"items\":[{\"text\":\"14 M-modeの実装 (1. CSRの実装)\",\"link\":\"/20-mmode-csr\"},{\"text\":\"15 M-modeの実装 (2. 割り込みの実装)\",\"link\":\"/21-impl-interrupt\"},{\"text\":\"16 U-modeの実装\",\"link\":\"/22-umode-csr\"},{\"text\":\"17 S-modeの実装 (1. CSRの実装)\",\"link\":\"/23-smode-csr\"},{\"text\":\"18 S-modeの実装 (2. 仮想記憶システム)\",\"link\":\"/24-impl-paging\"},{\"text\":\"19 PLICの実装\",\"link\":\"/25-impl-plic\"},{\"text\":\"20 Linuxを動かす\",\"link\":\"/26-run-linux\"},{\"text\":\"あとがき (第Ⅰ部)\",\"link\":\"/99-postface\"},{\"text\":\"あとがき (第Ⅱ部、第Ⅲ部)\",\"link\":\"/99b-postface\"},{\"text\":\"このプロジェクトに貢献する\",\"link\":\"/100-contribute\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/nananapo/veryl-riscv-book\"}],\"outline\":{\"level\":[2,4]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>